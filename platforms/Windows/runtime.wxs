<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <?include version.wxi?>
  <Package
      Language="1033"
      Manufacturer="swift.org"
      Name="Swift Windows Runtime ($(var.ProcessorArchitecture))"
      UpgradeCode="bea8c6dc-f73e-445b-9486-2333d1cf2886"
      Version="$(var.ProductVersion)"
      Scope="perMachine">
    <SummaryInformation Description="Swift Windows Runtime ($(var.ProcessorArchitecture))" />

    <Media Id="1" Cabinet="runtime.cab" EmbedCab="yes" />

    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLDIR" Name="Swift">
        <Directory Id="Runtimes" Name="Runtimes">
          <Directory Id="_" Name="$(var.ProductVersion)">
            <Directory Id="_usr" Name="usr">
              <Directory Id="_usr_bin" Name="bin">
                <Component Id="BlocksRuntime.dll">
                  <File Id="BlocksRuntime.dll" Source="$(var.SDK_ROOT)\usr\bin\BlocksRuntime.dll" Checksum="yes" />
                </Component>
                <Component Id="dispatch.dll">
                  <File Id="dispatch.dll" Source="$(var.SDK_ROOT)\usr\bin\dispatch.dll" Checksum="yes" />
                </Component>
                <Component Id="Foundation.dll">
                  <File Id="Foundation.dll" Source="$(var.SDK_ROOT)\usr\bin\Foundation.dll" Checksum="yes" />
                </Component>
                <Component Id="FoundationNetworking.dll">
                  <File Id="FoundationNetworking.dll" Source="$(var.SDK_ROOT)\usr\bin\FoundationNetworking.dll" Checksum="yes" />
                </Component>
                <Component Id="FoundationXML.dll">
                  <File Id="FoundationXML.dll" Source="$(var.SDK_ROOT)\usr\bin\FoundationXML.dll" Checksum="yes" />
                </Component>
                <Component Id="swift_Concurrency.dll">
                  <File Id="swift_Concurrency.dll" Source="$(var.SDK_ROOT)\usr\bin\swift_Concurrency.dll" Checksum="yes" />
                </Component>
                <Component Id="swift_Differentiation.dll">
                  <File Id="swift_Differentiation.dll" Source="$(var.SDK_ROOT)\usr\bin\swift_Differentiation.dll" Checksum="yes" />
                </Component>
                <Component Id="swiftDistributed.dll">
                  <File Id="swiftDistributed.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftDistributed.dll" Checksum="yes" />
                </Component>
                <Component Id="swift_RegexParser.dll">
                  <File Id="swift_RegexParser.dll" Source="$(var.SDK_ROOT)\usr\bin\swift_RegexParser.dll" Checksum="yes" />
                </Component>
                <Component Id="swift_StringProcessing.dll">
                  <File Id="swift_StringProcessing.dll" Source="$(var.SDK_ROOT)\usr\bin\swift_StringProcessing.dll" Checksum="yes" />
                </Component>
                <Component Id="swiftCore.dll">
                  <File Id="swiftCore.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftCore.dll" Checksum="yes" />
                </Component>
                <Component Id="swiftCxx.dll">
                  <File Id="swiftCxx.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftCxx.dll" Checksum="yes" />
                </Component>
                <Component Id="swiftDispatch.dll">
                  <File Id="swiftDispatch.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftDispatch.dll" Checksum="yes" />
                </Component>
                <!--
                <Component Id="swiftDemangle.dll">
                  <File Id="swiftDemangle.dll" Source="$(var.SDK_ROOT)\bin\swiftDemangle.dll" Checksum="yes" />
                </Component>
                -->
                <Component Id="swiftCRT.dll">
                  <File Id="swiftCRT.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftCRT.dll" Checksum="yes" />
                </Component>
                <Component Id="swiftRemoteMirror.dll">
                  <File Id="swiftRemoteMirror.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftRemoteMirror.dll" Checksum="yes" />
                </Component>
                <Component Id="swiftSwiftOnoneSupport.dll">
                  <File Id="swiftSwiftOnoneSupport.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftSwiftOnoneSupport.dll" Checksum="yes" />
                </Component>
                <Component Id="swiftWinSDK.dll">
                  <File Id="swiftWinSDK.dll" Source="$(var.SDK_ROOT)\usr\bin\swiftWinSDK.dll" Checksum="yes" />
                </Component>

                <Component Id="plutil.exe">
                  <File Id="plutil.exe" Source="$(var.SDK_ROOT)\usr\bin\plutil.exe" Checksum="yes" />
                </Component>
              </Directory>
            </Directory>
          </Directory>
        </Directory>

        <Component Id="EnvironmentVariables" Guid="8681d813-eb32-46f9-8b1c-f622b38b5eaf">
          <Environment Id="Path" Action="set" Name="Path" Part="last" Permanent="no" System="yes" Value="[INSTALLDIR]Runtimes\$(var.ProductVersion)\usr\bin" />
        </Component>
      </Directory>
    </StandardDirectory>

    <!-- Feature -->
    <Feature Id="SwiftRuntime" AllowAbsent="no" AllowAdvertise="yes" ConfigurableDirectory="INSTALLDIR" Description="Swift Windows Runtime ($(var.ProcessorArchitecture))" Level="1" Title="Swift Windows Runtime ($(var.ProcessorArchitecture))">
      <ComponentRef Id="BlocksRuntime.dll" />
      <ComponentRef Id="dispatch.dll" />
      <ComponentRef Id="Foundation.dll" />
      <ComponentRef Id="FoundationNetworking.dll" />
      <ComponentRef Id="FoundationXML.dll" />
      <ComponentRef Id="swift_Concurrency.dll" />
      <ComponentRef Id="swift_Differentiation.dll" />
      <ComponentRef Id="swift_RegexParser.dll" />
      <ComponentRef Id="swift_StringProcessing.dll" />
      <ComponentRef Id="swiftCore.dll" />
      <ComponentRef Id="swiftCxx.dll" />
      <ComponentRef Id="swiftCRT.dll" />
      <!-- <ComponentRef Id="swiftDemangle.dll" /> -->
      <ComponentRef Id="swiftDispatch.dll" />
      <ComponentRef Id="swiftDistributed.dll" />
      <ComponentRef Id="swiftRemoteMirror.dll" />
      <ComponentRef Id="swiftSwiftOnoneSupport.dll" />
      <ComponentRef Id="swiftWinSDK.dll" />

      <ComponentRef Id="EnvironmentVariables" />
    </Feature>

    <Feature Id="SwiftUtilities" AllowAbsent="yes" AllowAdvertise="yes" Description="Extra Swift Utilities Windows ($(var.ProcessorArchitecture))" Level="1" Title="Swift Utilities Windows ($(var.ProcessorArchitecture))">
      <ComponentRef Id="plutil.exe" />
    </Feature>

    <UI>
      <ui:WixUI Id="WixUI_InstallDir" />
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg" Order="2" />
      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2" />
    </UI>

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR"></Property>

    <WixVariable Id="WixUIDialogBmp" Value="Resources\swift_dialog.png" />
    <WixVariable Id="WixUIBannerBmp" Value="Resources\swift_banner.png" />
  </Package>
</Wix>
